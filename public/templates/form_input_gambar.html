<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Pendaftaran</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <!-- Bootstrap Bundle (JS) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- ReactJS -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>

<body>

  <div id="root"></div>

  <script type="text/babel">
    function App() {
      const [formData, setFormData] = React.useState({
        nama: '',
        email: '',
        telepon: '',
        gambar: null
      });

      // Function to handle file selection
      function handleFileSelect(event) {
        const file = event.target.files[0];
        const maxSize = 3 * 1024 * 1024; // 3 MB in bytes

        // Check if file is not undefined and is an image
        if (file && file.type.startsWith('image/')) {
          // Check file size
          if (file.size > maxSize) {
            alert('Ukuran file tidak boleh lebih dari 3 MB.');
            event.target.value = null; // Reset file input to clear the selected file
          } else {
            setFormData({ ...formData, gambar: file });
          }
        } else {
          alert('Harap pilih file gambar.');
          event.target.value = null; // Reset file input to clear the selected file
        }
      }

      // Function to handle form submission
      function handleSubmit(event) {
        event.preventDefault();

        console.log(formData.gambar)

        // Prepare form data as FormData object
        let formDataToSend = new FormData();
        formDataToSend.append('name', formData.nama);
        formDataToSend.append('email', formData.email);
        formDataToSend.append('phone', formData.telepon);
        formDataToSend.append('image', formData.gambar);

        // Make POST request to Google Apps Script
        const url = 'https://script.google.com/macros/s/AKfycbzbPeS8GIbdU7gap0Vi85AeOK-JcEsZ8AbkobjwKXOddEgnQxH2C1kwOLWgbv3_HbU/exec'
        fetch(url, {
          method: 'POST',
          body: formDataToSend
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.text();
          })
          .then(data => {
            console.log('Form submission successful:', data);
            // Reset form after successful submission (optional)
            // setFormData({ nama: '', email: '', telepon: '', gambar: null });
          })
          .catch(error => {
            console.error('Error during form submission:', error);
          });
      }


      return (
        <div className="container mt-5">
          <h1>Form Pendaftaran</h1>
          <form onSubmit={handleSubmit}>
            <div className="mb-3">
              <label htmlFor="nama" className="form-label">Nama Lengkap</label>
              <input type="text" className="form-control" id="nama" required
                value={formData.nama} onChange={(e) => setFormData({ ...formData, nama: e.target.value })} />
            </div>
            <div className="mb-3">
              <label htmlFor="email" className="form-label">Email</label>
              <input type="email" className="form-control" id="email" required
                value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} />
            </div>
            <div className="mb-3">
              <label htmlFor="telepon" className="form-label">Nomor Telepon</label>
              <input type="tel" className="form-control" id="telepon" required
                value={formData.telepon} onChange={(e) => setFormData({ ...formData, telepon: e.target.value })} />
            </div>
            <div className="mb-3">
              <label htmlFor="gambar" className="form-label">Upload Gambar (Maksimal 3 MB)</label>
              <input type="file" className="form-control" id="gambar" accept="image/*" onChange={handleFileSelect} required />
            </div>
            <button type="submit" className="btn btn-primary">Daftar</button>
          </form>
        </div>
      );
    }
  </script>

  <script type="text/babel">
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>

</body>

</html>