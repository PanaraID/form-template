<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Homepage with Bootstrap 5 and ReactJS CDN</title>

  <!-- Bootstrap 5 CSS CDN -->
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' rel='stylesheet'>

  <style>
    section {
      margin-top: 5px;
      margin-bottom: 5px;
    }
  </style>

  <!-- ReactJS and ReactDOM production CDN -->
  <script src='https://cdn.jsdelivr.net/npm/react@17.0.2/umd/react.production.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/react-dom@17.0.2/umd/react-dom.production.min.js'></script>

  <!-- Babel for inline JSX -->
  <script src='https://cdn.jsdelivr.net/npm/@babel/standalone@7.15.8/babel.min.js'></script>
</head>

<body>
  <div id='root'></div>

  <script>
    const TEXT = `
    const sheetName = 'Sheet1'; // Ganti sesuai nama tab dari spreadsheet
    const scriptProp = PropertiesService.getScriptProperties();

    function intialSetup() {
      const activeSpreadsheet = SpreadsheetApp.getActiveSpreadsheet();
      scriptProp.setProperty('key', activeSpreadsheet.getId());
    }

    function doPost(e) {
      const lock = LockService.getScriptLock();
      lock.tryLock(10000);

      try {
        const doc = SpreadsheetApp.openById(scriptProp.getProperty('key'));
        const sheet = doc.getSheetByName(sheetName);

        const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
        const nextRow = sheet.getLastRow() + 1;

        const newRow = headers.map(function (header) {
          return header === 'timestamp' ? new Date() : e.parameter[header];
        })

        sheet.getRange(nextRow, 1, 1, newRow.length).setValues([newRow]);

        return ContentService
          .createTextOutput(JSON.stringify({ 'result': 'success', 'row': nextRow }))
          .setMimeType(ContentService.MimeType.JSON);
      }

      catch (e) {
        return ContentService
          .createTextOutput(JSON.stringify({ 'result': 'error', 'error': e }))
          .setMimeType(ContentService.MimeType.JSON);
      }

      finally {
        lock.releaseLock();
      }
    }
    `;
  </script>

  <script type='text/babel'>
    const Navbar = () => {
      return (
        <nav className='navbar navbar-expand-lg navbar-light bg-light'>
          <div className='container'>
            <a className='navbar-brand' href='#'>Form Template</a>
            <button className='navbar-toggler' type='button' data-bs-toggle='collapse' data-bs-target='#navbarSupportedContent' aria-controls='navbarSupportedContent' aria-expanded='false' aria-label='Toggle navigation'>
              <span className='navbar-toggler-icon'></span>
            </button>

            <div className='collapse navbar-collapse' id='navbarSupportedContent'>
              <ul className='navbar-nav me-auto mb-2 mb-lg-0'>
                <li className='nav-item'>
                  <a className='nav-link active' aria-current='page' href='#'>Home</a>
                </li>
                <li className='nav-item'>
                  <a className='nav-link' href='#tutorial'>Tutorial</a>
                </li>
              </ul>
              <form className='d-flex'>
                <input className='form-control me-2' type='search' placeholder='Search' aria-label='Search' />
                <button className='btn btn-outline-success' type='submit'>Search</button>
              </form>
            </div>
          </div>
        </nav>
      )
    }

    const Jumbotron = () => {
      const demo = 'https://panaraid.github.io/form-template/templates/';
      const script = 'https://github.com/panaraid/form-template/blob/main/templates/';

      const data = [
        {
          'title': 'Form Pendaftaran',
          'decription': 'blabla',
          'demo': demo + 'form_pendaftaran.html',
          'script': script + 'form_pendaftaran.html'
        }
      ]
      return (
        <section className='container mt-4'>
          <div className='jumbotron'>
            <h1 className='display-4'>Hello, world!</h1>
            <p className='lead'>Menyediakan template-template form HTML yang terhubung dengan spreadsheet</p>
            <hr className='my-4' />
            <p>Berikut adalah beberapa template yang bisa digunakan</p>
          </div>

          {data.map((element, index) => {
            return (
              <div className='card'>
                <div className='card-body'>
                  <h5 className='card-title'>{element.title}</h5>
                  <h6 className='card-subtitle mb-2 text-body-secondary'>Card subtitle</h6>
                  <p className='card-text'>Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                  <a href={element.demo} className='card-link'>Demo</a>
                  <a href={element.script} className='card-link'>Script</a>
                </div>
              </div>
            )
          })}
        </section>
      )
    }

    const Tutorial = () => {

      const Accordion = ({ title, body }) => {
        const id = Math.random()

        return (
          <div className='accordion-item'>
            <h2 className='accordion-header'>
              <button className='accordion-button collapsed' type='button' data-bs-toggle='collapse' data-bs-target={'#' + id} aria-controls={id}>
                {title}
              </button>
            </h2>
            <div id={id} className='accordion-collapse collapse' data-bs-parent='#tutorial'>
              <div className='accordion-body'>
                {body}
              </div>
            </div>
          </div>
        )
      }

      const Img = ({img}) => <img src={"./img/" + img + ".png"} className="img-thumbnail" alt="..." />

      const Tentang = () => {
        const Body = () => {
          const Warning = () => {
            return (
              <div className='alert alert-warning' role='alert'>
                Satu spreadsheet hanya bisa digunakan untuk satu penyimpanan, jadi tidak bisa
                kustom dari beberapa tab!
              </div>
            )
          }

          return (
            <React.Fragment>
              <p>Template form yang terkoneksi dengan spreadsheet</p>
              <p>Untuk menggunakan silahkan lihat tutorial-tutorial berikut!</p>
              <Warning />

            </React.Fragment>
          )
        }

        return (
          <Accordion title='#1 Tentang' body={<Body />} />
        )
      }

      const MenyiapkanSpreadsheet = () => {
        const Body = () => {
          const Warning1 = () => {
            return (
              <div className='alert alert-warning' role='alert'>
                Satu spreadsheet hanya bisa digunakan untuk satu penyimpanan, jadi tidak bisa
                kustom dari beberapa tab!
              </div>
            )
          }

          const Warning2 = () => {
            return (
              <div className='alert alert-warning' role='alert'>
                Penamaan pada kolom ini harus sesuai dengan <i>script</i>, yang akan dijelaskan pada bagian berikut.
              </div>
            )
          }

          return (
            <React.Fragment>
              <ol>
                <li>Buat spreadsheet baru, atau gunakan yang sudah ada</li>
                <li>
                  <span>Tentukan tab yang ingin digunakan untuk penyimpanan</span>
                  <img src="./img/1668997237.png" className="img-thumbnail" alt="..." />
                  <Warning1 />
                </li>
                <li>
                  <span>Buat kolom pada tab pertama dengan tulisan <i>timestamp</i></span>
                  <img src="./img/0769902643.png" className="img-thumbnail" alt="..." />
                </li>
                <li>
                  <span>Silahkan isi kolom selanjutnya sesuai keinginan</span>
                  <img src="./img/0655020701.png" className="img-thumbnail" alt="..." />
                  <Warning2 />
                </li>
              </ol>
            </React.Fragment>
          )
        }

        return (
          <Accordion title='#2 Menyiapkan Spreadsheet' body={<Body />} />
        )
      }

      const MenghubungkanSpreadsheet = () => {
        const Body = () => {
          const [alert, setAlert] = React.useState();

          const Alert = () => {
            return (
              <div className='alert alert-success' role='alert'>
                Berhasil
              </div>
            )
          }

          const copy = () => {
            setAlert(true);
            navigator.clipboard.writeText(TEXT);

            setTimeout(() => {
              setAlert(false);
            }, 2000);
          }

          const Warning = () => {
            return (
              <div className='alert alert-warning' role='alert'>
                Mohon sesuaikan nama tab dengan variabel tersebut!
              </div>
            )
          }

          return (
            <React.Fragment>
              <ol>
                <li>
                  <span>Klik <i>Ekstensi</i>, lalu <i>Apps Script</i></span>
                  <img src="./img/1278865118.png" className="img-thumbnail" alt="..." />
                  <span>Nantinya, akan muncul tampilan sebagai berikut:</span>
                  <img src="./img/2343597564.png" className="img-thumbnail" alt="..." />
                </li>
                <li><b><i>Opsional</i></b>, nama project bisa diganti sesuka hati</li>
                <li>
                  <span>Silahkan copy sebuah script dengan menekan tombol </span>
                  {alert && <Alert />}
                  <button className='btn btn-primary' onClick={copy}>Copy</button>
                </li>
                <li>
                  <span>Lalu paste pada tampilan tadi</span>
                  <img src="./img/4607748788.png" className="img-thumbnail" alt="..." />
                  <Warning />
                </li>
                <li>
                  <span>Lalu tekan save</span>
                  <img src="./img/0010050056.png" className="img-thumbnail" alt="..." />
                </li>
                <li>
                  <span>Lalu klik tombol berikut</span>
                  <img src="./img/5755581513.png" className="img-thumbnail" alt="..." />
                </li>
                <li>
                  <span>Lalu klik tombol berikut untuk menjalankan</span>
                  <img src="./img/8467744180.png" className="img-thumbnail" alt="..." />
                </li>
              </ol>
            </React.Fragment>
          )
        }

        return (
          <Accordion title='#3 Menghubungkan Spreadsheet' body={<Body />} />
        )
      }

      const accordions = [
        <Tentang />,
        <MenyiapkanSpreadsheet />,
        <MenghubungkanSpreadsheet />,
      ];

      return (
        <section className='accordion' id='tutorial'>
          {accordions.map((e, i) => e)}
          <div className='accordion-item'>
            <h2 className='accordion-header'>
              <button className='accordion-button collapsed' type='button' data-bs-toggle='collapse' data-bs-target='#collapseTwo' aria-expanded='false' aria-controls='collapseTwo'>
                Accordion Item #2
              </button>
            </h2>
            <div id='collapseTwo' className='accordion-collapse collapse' data-bs-parent='#tutorial'>
              <div className='accordion-body'>
                <strong>This is the second item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
              </div>
            </div>
          </div>
          <div className='accordion-item'>
            <h2 className='accordion-header'>
              <button className='accordion-button collapsed' type='button' data-bs-toggle='collapse' data-bs-target='#collapseThree' aria-expanded='false' aria-controls='collapseThree'>
                Accordion Item #3
              </button>
            </h2>
            <div id='collapseThree' className='accordion-collapse collapse' data-bs-parent='#tutorial'>
              <div className='accordion-body'>
                <strong>This is the third item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
              </div>
            </div>
          </div>
        </section>
      )
    }
  </script>

  <script type='text/babel'>
    const App = () => {
      return (
        <div className='container'>
          <Navbar />
          <Jumbotron />
          <Tutorial />
        </div>
      )
    }
  </script>

  <script type='text/babel'>
    ReactDOM.render(
      <App />,
      document.getElementById('root')
    );
  </script>

  <!-- Bootstrap 5 JS and dependencies -->
  <script src='https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js'></script>
</body>

</html>